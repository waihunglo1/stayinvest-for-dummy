<html>

<head>
    <title>TradingView Snapshot</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="msapplication-TileColor" content="#da532c">
	<meta name="theme-color" content="#ffffff">	    
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Audiowide|Sofia|Trirong|Platypi|Noto Sans Traditional Chinese">
	<link rel="stylesheet" href="css/styles.css">

	<link rel="apple-touch-icon" sizes="180x180" href="icon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="icon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="icon/favicon-16x16.png">
	<link rel="manifest" href="icon/site.webmanifest">
	<link rel="mask-icon" href="icon/safari-pinned-tab.svg" color="#5bbad5">

    <!-- progress bar -->
    <link rel="stylesheet" type="text/css" href="css/loading-bar.css"/>
    <script type="text/javascript" src="js/loading-bar.js"></script>
    <script type="text/javascript" src="js/themes.js"></script>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
</head>

<body>
    <div id="progress_home"></div>
    <div id="tradingViewGrid" class="wrapper">
        <div id="tv0001"></div>
        <div id="tv0002"></div>
        <div id="tv0003"></div>
        <div id="tv0004"></div>
        <div id="tv0005"></div>
        <div id="tv0006"></div>
        <div id="tv0007"></div>
        <div id="tv0008"></div>
        <div id="tv0009"></div>
        <div id="tv0010"></div>
        <div id="tv0011"></div>
        <div id="tv0012"></div>
        <div id="tv0013"></div>
        <div id="tv0014"></div>
        <div id="tv0015"></div>
        <div id="tv0016"></div>
        <div id="tv0017"></div>
        <div id="tv0018"></div>
        <div id="tv0019"></div>
        <div id="tv0020"></div>
        <div id="tv0021"></div>
        <div id="tv0022"></div>
        <div id="tv0023"></div>
        <div id="tv0024"></div>
        <div id="tv0025"></div>
        <div id="tv0026"></div>
        <div id="tv0027"></div>
        <div id="tv0028"></div>
        <div id="tv0029"></div>
        <div id="tv0030"></div>
        <div id="tv0031"></div>
        <div id="tv0032"></div>
        <div id="tv0033"></div>
        <div id="tv0034"></div>
        <div id="tv0035"></div>
        <div id="tv0036"></div>
        <div id="tv0037"></div>
        <div id="tv0038"></div>
        <div id="tv0039"></div>
        <div id="tv0040"></div>
    </div>

    <!-- add tradingView widget-->
    <script type="text/javascript">
        window.onload = parseLocationAndShowCharts;  

        function parseLocationAndShowCharts() {
            const {inputStockCodes, chartType, taIndicator} = parseParameters();

            let ind = 1;
            partitionStockCodesAndSort("SPY," + inputStockCodes, taIndicator, "#progress_home", "YH")
                .then(function (sortedStockCodes) {
                    sortedStockCodes.forEach(stockCode => {
                        if (stockCode.errmsg == "") {
                            var desc = stockCode.name;
                            var borderStyle = null;
                            if (stockCode.symbol == 'SPY') {
                                borderStyle = "5px solid orange";
                            }

                            // add trading view mini
                            var containerId = "tv" + ind.toString().padStart(4, '0');
                            addTradingViewWidget(stockCode, containerId);
                            ind++;
                        } else {
                            console.log(stockCode);
                        }
                    });
                })
                .catch(function (error) {
                    console.error(error);
                });
        }

        function parseParameters() {
            // handler input parameter
            const params = new URLSearchParams(document.location.search);
            const inputStockCodes = params.get("o");
            const t = params.get("t");
            const a = params.get("a");
            const d = params.get("d");

            // stock codes
            console.log("parseLocationAndShowCharts o = " + inputStockCodes);
            console.log("parseLocationAndShowCharts t = " + t);
            console.log("parseLocationAndShowCharts a = " + a);
            console.log("parseLocationAndShowCharts d = " + d);

            // chart type
            if (t == null) {
                console.info("parameter t is null!!"); //show t
                chartType = 'HK';
            } else {
                chartType = t; // SC or SC6M
            }

            // taIndicator
            if (a == null) {
                console.info("taIndicator is null");
                taIndicator = "M12";
            } else {
                taIndicator = a; // M12 or B14
            }

            // description
            if (d != null) {
                let title_el = document.querySelector("title");
                if (title_el) {
                    title_el.innerHTML = d;
                }
            }

            return {inputStockCodes, chartType, taIndicator};
        }

        function addButton(parentId, buttonLabel) {
            const buttonElement = document.createElement("button");
            buttonElement.setAttribute("class","button-6");
            buttonElement.innerText = buttonLabel;
            // buttonElement.onclick = function() { gotoPage(taIndicator, chartType); };
            document.getElementById(parentId).appendChild(buttonElement);
        }        

        function addTradingViewWidget(stockCode, containerId) {
            var widget = new TradingView.widget({
                "width": "400",
                "height": "350",
                "symbol": stockCode.tradingViewSymbol,
                "interval": "D",
                "timezone": "exchange",
                "theme": "light",
                "style": "1",
                "locale": "en",
                "hide_top_toolbar": true,
                "enable_publishing": false,
                "withdateranges": true,
                "allow_symbol_change": false,
                "save_image": false,
                "calendar": false,
                "support_host": "https://www.tradingview.com",
                "studies": [
                    {
                        id: "MASimple@tv-basicstudies",
                        inputs: {
                            length: 20
                        }
                    },
                    {
                        id: "MASimple@tv-basicstudies",
                        inputs: {
                            length: 50
                        }
                    },
                    {
                        id: "STD;ROC",
                        inputs: {
                            length: 12
                        }
                    }
                ] ,
                "container_id": containerId
            });

            addButton(containerId,"TradingView");
            addButton(containerId,"Signal");
        }
    </script>

  </body>

</html>